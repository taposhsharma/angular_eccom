{"ast":null,"code":"import { __decorate } from \"tslib\";\nimport { Component } from '@angular/core';\nimport { Validators } from '@angular/forms';\nimport { catchError } from 'rxjs/operators';\nimport { selectIsLogin } from '../../store/app.selector';\nimport { take } from 'rxjs/operators';\nimport * as MyActions from '../../store/app.actions';\nexport let LoginComponent = class LoginComponent {\n  constructor(fb, http, store, authService) {\n    this.fb = fb;\n    this.http = http;\n    this.store = store;\n    this.authService = authService;\n    this.isAuthenticated = false;\n    this.isAuthenticated = this.authService.isAuthenticated();\n    const token = this.authService.getAuthToken();\n    console.log(token);\n  }\n  ngOnInit() {\n    this.loginForm = this.fb.group({\n      email: ['', [Validators.required, Validators.email]],\n      password: ['', Validators.required]\n    });\n    this.store.select(selectIsLogin).pipe(take(1)) // Use 'take(1)' to automatically unsubscribe after the first emission\n    .subscribe(isLogin => {\n      this.isLogin = isLogin;\n    });\n  }\n  onSubmit() {\n    console.log('hello');\n    if (this.loginForm.valid) {\n      console.log(this.loginForm.value.firstName);\n      const postData = {\n        ...this.loginForm.value\n      };\n      const url = 'http://localhost:3000/users/login';\n      this.http.post(url, postData).pipe(catchError(error => {\n        console.error('Error sending POST request', error);\n        throw error;\n      })).subscribe(response => {\n        console.log('POST request successful', response);\n        this.responseData = response;\n        if (this.responseData) {\n          const user = this.responseData.user;\n          const authToken = this.responseData.token;\n          this.authService.setAuthData(user, authToken);\n          this.isAuthenticated = true;\n        }\n        const token = this.authService.getAuthToken();\n        console.log(token);\n        this.store.dispatch(MyActions.login());\n      });\n    }\n  }\n};\nLoginComponent = __decorate([Component({\n  selector: 'app-login',\n  templateUrl: './login.component.html',\n  styleUrls: ['./login.component.css'][Symbol]\n})], LoginComponent);","map":{"version":3,"names":["Component","Validators","catchError","selectIsLogin","take","MyActions","LoginComponent","constructor","fb","http","store","authService","isAuthenticated","token","getAuthToken","console","log","ngOnInit","loginForm","group","email","required","password","select","pipe","subscribe","isLogin","onSubmit","valid","value","firstName","postData","url","post","error","response","responseData","user","authToken","setAuthData","dispatch","login","__decorate","selector","templateUrl","styleUrls","Symbol"],"sources":["/home/tapos/Desktop/Angular/eccom/client/src/app/login/login.component.ts"],"sourcesContent":["import { Component, OnInit } from '@angular/core';\nimport { FormBuilder, FormGroup, Validators } from '@angular/forms';\nimport { HttpClient } from '@angular/common/http';\nimport { catchError, retry } from 'rxjs/operators';\nimport { Store } from '@ngrx/store';\nimport { selectIsLogin } from '../../store/app.selector';\nimport { take } from 'rxjs/operators';\nimport * as MyActions from '../../store/app.actions';\nimport { AuthService } from '../auth.service';\n\n@Component({\n  selector: 'app-login',\n  templateUrl: './login.component.html',\n  styleUrls: ['./login.component.css'][Symbol]\n})\nexport class LoginComponent implements OnInit {\n  responseData:any\n  loginForm: FormGroup;\n  isLogin: boolean | undefined;\n  isAuthenticated: boolean = false;\n  constructor(private fb: FormBuilder, private http: HttpClient,private store: Store,private authService: AuthService) { \n    this.isAuthenticated = this.authService.isAuthenticated();\n    const token = this.authService.getAuthToken()\n    console.log(token)\n   \n  }\n\n  ngOnInit() {\n\n  \n\n    \n    this.loginForm = this.fb.group({\n      email: ['', [Validators.required, Validators.email]],\n      password: ['', Validators.required]\n    });\n\n    this.store\n    .select(selectIsLogin)\n    .pipe(take(1)) // Use 'take(1)' to automatically unsubscribe after the first emission\n    .subscribe((isLogin) => {\n      this.isLogin = isLogin;\n      \n    });\n    \n  \n  }\n\n  onSubmit() {\n    console.log('hello')\n    if (this.loginForm.valid) {\n      \n      console.log(this.loginForm.value.firstName);\n\n      const postData = {\n         ...this.loginForm.value\n      };\n  \n      const url = 'http://localhost:3000/users/login'; \n  \n      this.http.post(url, postData)\n      .pipe(\n        catchError((error) => {\n        \n          console.error('Error sending POST request', error);\n          throw error;\n        })\n      )\n      .subscribe((response) => {\n        console.log('POST request successful', response);\n\n        this.responseData =response\n        if(this.responseData){\n        const user = this.responseData.user\n        const authToken = this.responseData.token  \n        this.authService.setAuthData(user,authToken);\n        this.isAuthenticated = true;\n      \n        }\n        \n        const token = this.authService.getAuthToken()\n        console.log(token)\n        this.store.dispatch(MyActions.login());\n        \n      });\n    }\n  }\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}